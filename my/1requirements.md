# 要件文書 (LLM TalkTable)

## 概要

`simonw/llm` ライブラリを利用して、2つの大規模言語モデル (LLM) 同士に指定されたテーマについて会話させるアプリケーションです。会話の内容は、アプリケーション専用の SQLite データベースに記録されます。会話の質を高めるために、モデレーター（MC）を導入し、会話の進行を管理します。

## 要件

### 要件 1

**ユーザーストーリー:** ユーザーとして、2体のLLMにテーマについて会話させたいので、LLM同士の意見交換を見られる

#### 受入基準

1.  WHEN ユーザーがアプリケーションを起動し、テーマと2体のLLMを指定する THEN システムは指定されたLLM同士でテーマに関する往復形式の会話を開始する SHALL
2.  WHEN 会話が進行する THEN システムは各ターンのプロンプトとレスポンスをコンソールに出力する SHALL
3.  WHEN 会話が終了する（またはユーザーが中断する） THEN システムは会話を終了する SHALL

### 要件 2

**ユーザーストーリー:** ユーザーとして、会話の参加LLMやペルソナを設定したいので、柔軟に会話シナリオをカスタマイズできる

#### 受入基準

1.  WHEN ユーザーが設定ファイルにLLMの名前、モデルID、ペルソナを記述する THEN システムはその設定を読み込み、会話に使用する SHALL
2.  WHEN ユーザーが起動引数でテーマを指定する THEN システムはそのテーマで会話を開始する SHALL
3.  WHEN 設定ファイルまたは引数が不正である THEN システムは適切なエラーメッセージを表示し、アプリケーションを終了する SHALL

### 要件 3

**ユーザーストーリー:** ユーザーとして、会話にモデレーター（MC）を導入したいので、会話がより構造化され、読みやすく興味深くなる

#### 受入基準

1.  WHEN 会話が開始される THEN システムはMCが会話のテーマと参加者を紹介する発言を行う SHALL
2.  WHEN 各ラウンド（A->B->Aの一連のやり取り）が開始される THEN システムはMCがそのラウンドの焦点や期待を述べる発言を行う SHALL
3.  WHEN 各ラウンドが終了される THEN システムはMCが両者の発言を要約し、次のラウンドへの橋渡しをする発言を行う SHALL
4.  WHEN あらかじめ決められたラウンド数が終了する THEN システムはMCが会話を締めくくる発言を行う SHALL

### 要件 4

**ユーザーストーリー:** ユーザーとして、会話内容を後で参照したいので、詳細なログが残る

#### 受入基義

1.  WHEN 会話が進行する THEN システムは各ターンの発言者、使用モデル、プロンプト、レスポンスをSQLiteデータベースに記録する SHALL
2.  WHEN データベースにMCの発言が記録される THEN システムはそのレコードにMCであることを識別するフラグを立てる SHALL
3.  WHEN 会話セッションが開始される THEN システムは会話のメタデータ（テーマ、参加者）をデータベースに記録する SHALL

### 要件 5

**ユーザーストーリー:** ユーザーとして、会話の途中で中断・継続を選択したいので、柔軟に会話を見守れる

#### 受入基準

1.  WHEN ユーザーが会話中に `Ctrl+C` を押下する THEN システムは会話を一時中断し、ユーザーに継続(S)または終了(C)の選択肢を提示する SHALL
2.  WHEN ユーザーが `C` を選択する THEN システムは現在のターンを再試行または次のターンに進む SHALL
3.  WHEN ユーザーが `S` を選択する THEN システムは会話を終了する SHALL

### 要件 6

**ユーザーストーリー:** ユーザーとして、会話の要約や評価を見たいので、会話の価値を再評価できる

#### 受入基準

1.  WHEN 会話セッションが終了する THEN システムはMCが会話全体の要約を行う発言を出力する（および/またはデータベースに記録する） SHALL
2.  （将来） WHEN ユーザーが要約オプションを有効にする THEN システムは会話を別のLLMに要約させ、結果を出力する SHALL